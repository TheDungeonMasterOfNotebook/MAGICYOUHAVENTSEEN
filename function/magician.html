<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Magician Notes</title>
<style>
body { font-family:-apple-system; background:#fff8dc; margin:0; }
header { padding:14px; background:#f6e6b4; text-align:center; font-weight:600; }
.note-area { margin:20px; background:#fffdf3; border-radius:10px; padding:15px; min-height:200px; }
#status { margin-top:10px; color:#666; text-align:center; }
#micBtn { position:fixed; bottom:24px; right:24px; font-size:28px; cursor:pointer; background:rgba(255,255,255,0.9); border-radius:50%; width:60px; height:60px; display:flex; align-items:center; justify-content:center; box-shadow:0 2px 6px rgba(0,0,0,0.3); }
#micBtn:active { transform: scale(0.95); }
</style>
</head>
<body>

<header>Notes</header>
<div class="note-area" contenteditable="true" id="noteArea">- Write notes here...</div>
<div id="status">Tap the microphone to start listening</div>
<div id="micBtn">üéôÔ∏è</div>

<script>
const status = document.getElementById('status');

// 52 cards
const suits = ['clubs','hearts','spades','diamonds'];
const ranks = ['ace','2','3','4','5','6','7','8','9','10','jack','queen','king'];
const cards = [];
for(let s of suits){ for(let r of ranks){ cards.push(`${r}_of_${s}`); } }

// Mapping spoken words to card numbers
const keywords = ['one','two','three','four','five','six','seven','eight','nine','ten','jack','queen','king'];

async function sendPrediction(card){
  await fetch("/.netlify/functions/sendPrediction", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ card })
  });
}

let recognition;
if('webkitSpeechRecognition' in window){
  recognition = new webkitSpeechRecognition();
  recognition.continuous = false;
  recognition.lang = 'en-US';
  recognition.interimResults = false;

  recognition.onstart = ()=> status.textContent = "Listening...";
  recognition.onresult = async (e)=>{
    const spoken = e.results[0][0].transcript.trim().toLowerCase();
    status.textContent = `Heard: "${spoken}"`;

    const index = keywords.indexOf(spoken);
    if(index >=0){
      const card = cards[index];
      await sendPrediction(card);
      status.textContent = `Prediction sent: ${card}`;
    }
  };
  recognition.onerror = e=> status.textContent = "Error: "+e.error;
}

document.getElementById('micBtn').onclick = ()=> recognition.start();
</script>

</body>
</html>
